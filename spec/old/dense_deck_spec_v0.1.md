# Dense Deck Poker – 4max Single Blind Mode
## 基本仕様書 v0.1（MVP）

---

## 1. ゲーム概要

Dense Deck Poker（Super Dense モード）は、NLHE（ノーリミット・テキサスホールデム）をベースにした  
**スターティングハンドを制限するバリアント**である。

許可ハンドは `allowedHands.json` により制御され、  
NLHE で弱すぎるハンドが排除されることで、

- プレイ密度の向上  
- レンジ対レンジの駆け引きの濃縮  
- 退屈時間の大幅減少  

が実現される。

プレーヤー人数は **4名（UTG / CO / BTN / BB）**  
SB は存在せず、シングルブラインド形式とする。

---

## 2. デッキ仕様

### 2.1 デッキ構成
- 52 枚の通常デッキを使用する  
- ただしスターティングハンドは `allowedHands.json` によって制限される  
- 不許可のハンドが配られた場合は、許可されるまで **自動リドロー**を行う

### 2.2 ハンドクラス判定

#### 2.2.1 クラスキー生成ルール
2枚のカードから以下のルールでクラスキーを生成する。

1. ランクが同じ場合 → `"AA"`, `"77"` など  
2. ランクが異なる場合  
   - 高いランクを左に置く（例：A と T → `"AT"`）  
   - スート一致 → `"s"`（スーテッド）  
   - スート不一致 → `"o"`（オフスート）  
   - 例：`"AKs"`, `"QJo"`  

#### 2.2.2 許可判定
key = getClassKey(card1, card2)
return allowedHands[key].superDense === true

---

## 3. ポジション定義（4max）

座席順は以下の通り：

1. **UTG**
2. **CO**
3. **BTN**
4. **BB**

### 3.1 SB が存在しない理由
Dense Deck では参加率が高いため、SB の不利性が大きくなりすぎる。  
シングルブラインド制にすることで **ゲーム性とバランスをシンプル化**する。

---

## 4. ブラインド・スタック仕様

- **BB = 1BB（強制ポスト）**
- **SB = 0**
- **初期スタック = 100BB**
- ベット構造は **ノーリミット（NLHE準拠）**

---

## 5. ゲームフロー

### 5.1 ラウンド進行

1. BB の左（UTG）からカードを2枚ずつ配る
2. プリフロップ・アクション
3. フロップ（3枚）公開 → アクション
4. ターン（1枚）公開 → アクション
5. リバー（1枚）公開 → アクション
6. ショーダウン

### 5.2 利用可能アクション
- Fold  
- Check  
- Call  
- Bet  
- Raise  
- All-in  

### 5.3 役判定
- NLHE と同じ役構造  
- ホールカード2枚＋ボードの合計7枚から **5枚を選んで最強役を作る**

---

## 6. プリフロップ仕様（MVP用AIの推奨方針）

Dense Deck 自体はプレイヤーの自由意志を妨げないが、  
AIの最初のバージョンでは以下の簡易ルールを採用する。

### 6.1 各ポジションの推奨AIレンジ

- **UTG:**  
  許可ハンドの 80〜90% をオープン。  
  最弱クラスのみフォールド。

- **CO:**  
  UTG より広い。実質ほぼ全ハンドオープン。

- **BTN:**  
  **すべての許可ハンドをオープン（RFI 100%）**

- **BB:**  
  許可ハンドのほとんどをディフェンス。  
  明確に弱すぎる offsuit（例：54o など）はフォールド。

---

## 7. ポストフロップ仕様（MVP）

AIロジック（MVP）では以下の簡易方針を採用する。
1. 役がある → ベット
2. 強いドローがある → ベット
3. その他 → チェック
4. 相手のベットには
　　- 強い役 or 強いドロー → コール
　　- それ以外 → フォールド

※ 将来バージョンで GTO近似を導入可能

ポストフロップのルールは NLHE と完全に同じ。

---

## 8. 勝敗判定

NLHE の標準役に従う：

- ロイヤルフラッシュ  
- ストレートフラッシュ  
- 4カード  
- フルハウス  
- フラッシュ  
- ストレート  
- 3カード  
- 2ペア  
- 1ペア  
- ハイカード  

タイブレークの方法も NLHE と同様。

---

## 9. UI仕様（MVP最小構成）

### 9.1 テーブル画面
- 4人分の座席表示  
- ボタン位置（BTN）  
- プレイヤースタック  
- ベット量  
- ポットサイズ  
- プレイヤーのカード  
- ボード（フロップ / ターン / リバー）  

### 9.2 アクションUI
- Fold / Call / Raise（可変サイズ）  
- All-in  
- ベットスライダー（任意）

### 9.3 設定画面
- Dense Deck モード選択（初期：Super Dense のみ）  
- サウンド  
- テーマ  
- ゲームスピード  

### 9.4 ハンド履歴画面
- 各ストリートのアクションログ  
- Show / Muck  
- 結果表示（勝者 / 役 / ポット）

---

## 10. AI（MVP版）

### 10.1 目的
- プレイヤーが「自然に戦える相手」を目指す  
- GTO は不要  
- NLHEの直感的プレイに近い動きで十分

### 10.2 動作方針（簡易）
- プリフロップは  
  - BTNは100%オープン  
  - BBは広くディフェンス  
  - UTGはややタイト  
- ポストフロップは  
  - 役 or 強ドロー → 値打ち  
  - その他 → チェック  
  - ベットには役 or ドローでコール  

---

## 11. 将来拡張（v1.1以降）

- HU 20BB Dense Deck モード  
- 緩めの Normal Dense モード  
- オンライン対戦（PvP）  
- 高機能なリプレイ解析・コーチング機能  
- クラウド保存  

---

## 12. MVP 完成条件

- Dense Deck の配布が正しく行われる  
- 4max シングルブラインドで正しく進行する  
- プリフロップ〜リバー〜ショーダウンまで1ゲーム完走  
- AIが最低限戦える  
- ハンド履歴を閲覧可能  

以上で MVP とする。

