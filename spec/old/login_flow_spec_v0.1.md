# 01. 起動時 / ゲスト開始フロー

## 概要
アプリ起動時の共通フロー。
ログイン画面に止めず、常にプレイ可能な状態から開始する。

---

## フロー

1. アプリ起動
2. `GET /api/auth/me` を呼び出す
   - 有効なセッションが存在する場合
     - セッションの有効期限を90日に延長
     - ユーザー情報を取得
   - セッションが存在しない場合
     - 新規ゲストを作成
     - session + userId を発行
     - cookie に保存
3. Home / Game 画面へ遷移

---

## 補足仕様
- 起動時にログイン画面で止まることはない
- ゲストは同一ブラウザ・cookie保持中のみ継続
- cookie削除時は新規ゲストとして開始

# 02. Home / アカウント導線

## 概要
ゲーム画面からアカウント関連機能への最小導線。

---

## 画面：Home / Game

### 表示要素
- 現在の username
- アカウントボタン（⚙ / Profile 等）

### 遷移
- [Tap] アカウントボタン
  → Account 画面へ

# 03. アカウント画面

## 概要
ユーザー状態（ゲスト / 登録）に応じて表示を切り替える。

---

## 画面：Account

### 共通表示
- username
- username変更ボタン（可能 / 不可を表示）
- ログアウトボタン

---

## ゲストユーザーの場合
- 「登録して引き継ぐ」ボタンを表示

### 遷移
- [Tap] 登録して引き継ぐ
  → Register 画面へ

---

## 登録ユーザーの場合
- email（マスク表示）
- パスワード変更（任意 / MVPでは省略可）

---

## ログアウト
- ログアウト確認モーダルを表示
- 実行時：
  - セッション破棄
  - 次回起動時は新規ゲストとして開始

# 04. username変更フロー

## 概要
username は初期値から1回のみ変更可能。

---

## 画面：UsernameChange

### 表示
- username入力欄
- ルール表示
  - 最大20文字
  - 使用可能文字：a-z A-Z 0-9 _ . -
  - 日本語・全角・絵文字不可
- 変更残数表示
  - 「残り1回」または「変更不可」

---

## 挙動
- 保存成功
  - username を更新
  - 変更権を消費（以後変更不可）
  - Account画面へ戻る
- バリデーションエラー
  - エラーメッセージを表示

---

## 補足仕様
- 登録時に既に変更されていた場合、その時点で変更不可

# 05. ゲスト → 登録（昇格）

## 概要
ゲストユーザーを同一 userId のまま登録ユーザーへ昇格する。

---

## 画面：Register

### 入力項目
- email
- password
- password確認（推奨）

### 表示
- 「すでに登録済み？ログイン」リンク

---

## 挙動
- 登録成功
  - ゲスト userId のまま登録ユーザーへ昇格
  - ゲストセッションを破棄
  - 登録ユーザー用セッションを新規発行
  - Home 画面へ遷移
- email 重複
  - 登録失敗
  - 「そのメールは登録済みです。ログインしてください」
  - Login 画面への導線を表示

# 06. ログイン

## 概要
登録ユーザー向けログインフロー。

---

## 画面：Login

### 入力項目
- email
- password

### 表示
- 「ログイン」ボタン
- 「パスワードを忘れた」リンク
- 「新規登録」リンク

---

## 挙動
- ログイン成功
  - セッション発行
  - Home 画面へ
- ログイン失敗
  - 汎用エラーメッセージ
  - （email存在有無は表示しない）

# 07. パスワードリセット

## 概要
メールリンク方式のパスワードリセット。

---

## 画面：PasswordResetRequest

### 入力
- email

### 挙動
- 対象 email の存在有無に関わらず同一文言を表示
  - 「リセット用リンクを送信しました」

---

## 画面：PasswordResetSent
- メール確認案内
- ログイン画面へ戻るリンク

---

## 画面：PasswordResetForm

### 入力
- 新しい password
- password確認

### 挙動
- 成功
  - パスワード更新
  - ログイン画面へ
- 失敗（期限切れ / 無効 / 使用済）
  - エラーメッセージ
  - 再申請導線を表示

---

## 補足仕様
- リセットリンク有効期限：1時間
- ワンタイムトークン

# 08. ログアウト

## 概要
ゲスト / 登録ユーザー共通のログアウト処理。

---

## フロー
1. ログアウト確認モーダル表示
2. 実行時
   - セッション破棄
3. 次回アクセス時
   - 新規ゲストとして開始

---

## 補足
- ログアウト後に即ログイン画面へは遷移しない
