# ルーム作成以降の画面遷移仕様（MVP）概要

本仕様は、Dense Deck Poker クローズドβ1.0（MVP）における  
**「ルーム作成以降」の画面遷移とUI状態管理**を定義する。

## 基本方針

- 「ルーム待機画面」は廃止する
- 待機・着席・進行はすべて「対戦画面（RoomView）」に内包する
- 画面数は最小限に抑える
- MVPでは安定性・実装容易性を最優先する

## 画面構成（MVP）

1. ルーム一覧画面（RoomList）
2. ルーム条件入力画面（RoomCreateForm）
3. 対戦画面（RoomView）

※ 観戦・途中参加・自動マッチングは対象外

# ルーム作成フロー

## フロー概要

RoomList
  → RoomCreateForm
    → RoomView（SEATING）

## 1. ルーム一覧（RoomList）

- 「ルーム作成」ボタンを表示
- 押下でルーム条件入力画面へ遷移

## 2. ルーム条件入力画面（RoomCreateForm）

### 入力項目（MVP）

- ルーム名（任意）
- パスワード有無
- ルームタグ
  - 初心者歓迎
  - 真剣勝負
  - 未設定
- 初期スタック
  - MVPでは固定：200BB

### 動作

- 「作成」押下
- API: createRoom
- 成功時：
  - 作成者は自動的にルームへ join
  - 作成者がオーナーになる
  - RoomView へ遷移

## 3. RoomView（作成直後）

- 状態：SEATING（ゲーム未開始）
- 着席状態・開始条件を表示

# ルーム参加フロー

## フロー概要

RoomList
  → RoomView（IN_HAND）

## 前提ルール

- ルーム作成者は必ず着席済み
- よって「人数不足」は考慮しない

## 1. ルーム一覧（RoomList）

- 各ルーム行に「参加」ボタンを表示
- PW付きルームは参加時に入力

## 2. ルーム参加

- API: joinRoom(roomId, pw?)
- 成功時：RoomViewへ遷移

## 3. RoomView（参加直後）

- 原則としてゲーム開始状態（IN_HAND）
- サーバー側で開始状態を保証する
  - join完了時に IN_HAND を返す
  - または自動で startGame を実行

# 対戦画面（RoomView）状態定義

RoomView は単一画面であり、内部状態によってUIを切り替える。

## RoomView 内部状態

- SEATING
  - 着席・待機（ゲーム未開始）
- IN_HAND
  - ハンド進行中
- HAND_BOUNDARY_DECISION
  - ハンド境界でのオーナー判断モーダル表示中

---

## SEATING 状態

### 表示要素

- ルーム情報（ID / タグ / PW有無）
- 席（UTG / CO / BTN / BB）
- 各席の着席者
- 操作
  - 着席
  - 退出
  - ゲーム開始（オーナーのみ）

### 開始条件

- 着席者数が「人数OK」条件を満たすと開始可能
- 条件は仕様として固定（例：2人以上）

---

## IN_HAND 状態

### 表示要素

- テーブルUI一式
- ボード / ポット / スタック
- アクションUI
- 簡易ログ
- 退出ボタン

### 退出の基本方針

- 退出は即時反映せず「退出予約」とする
- ハンド中は autoFold / autoCheck で進行

---

## HAND_BOUNDARY_DECISION 状態

- ハンド終了後にのみ発火
- 次ハンド開始を停止
- オーナー判断モーダルを表示

# オーナー退出・移譲仕様（MVP）

## 基本方針

- MVPでは IN_HAND 中のオーナー移譲を許可しない
- 権限変更は必ずハンド境界で行う

---

## SEATING 中のオーナー退出

- 退出押下で即モーダル表示

### 選択肢

1. ルーム解散
2. オーナー移譲

---

## IN_HAND 中のオーナー退出

- 退出押下時点ではモーダルを出さない
- 「退出予約」状態にする
- ハンド中は autoFold / autoCheck で進行

### ハンド終了時

- HAND_BOUNDARY_DECISION 状態へ遷移
- 選択モーダルを表示

---

## 選択肢詳細

### 1. ルーム解散

- ルームを CLOSED にする
- 全参加者を RoomList に戻す

### 2. オーナー移譲

- 2番目に入室したユーザーへ移譲
- 旧オーナーは退出確定
- 残りプレイヤーは次ハンド待ちへ

# オーナー移譲ロジック（MVP）

## 移譲先の定義

- 「2番目に入室したユーザー」とする

## 実装上の推奨データ

- ownerUserId
- joinOrder または joinedAt
- secondUserId（join確定時に保存しておくと安全）

## 移譲不能ケース

- 2番目のユーザーが既に退出している場合

### MVPでの対応方針（推奨）

- 現在在室者のうち joinOrder 最小（オーナー除外）へ移譲
- 在室者がいなければルーム解散

# 将来課題（MVP対象外）

## フルPvP以降の検討事項

- フォールド後に限り IN_HAND 中のオーナー移譲を許可
- 観戦機能
- 再接続時の権限同期
- 自動マッチング
- 途中参加

本仕様では、これらは意図的に除外する。
